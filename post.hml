<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Create Post</title>
  <style>
    body{font-family:Arial,sans-serif;background:#f6f7f8;margin:0}
    .wrap{max-width:640px;margin:20px auto;padding:12px}
    .card{background:#fff;padding:12px;border-radius:10px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
    input,textarea{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ddd}
    .preview img{max-width:100%;border-radius:8px}
    button{padding:10px 14px;border:none;border-radius:8px;background:#1da1f2;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h3>Create Post</h3>
      <div>
        <label><strong>Image</strong></label><br>
        <input id="imageInput" type="file" accept="image/*"><br>
        <div class="preview" id="preview"></div>
      </div>

      <div>
        <label><strong>Caption</strong></label>
        <textarea id="caption" rows="3" placeholder="Write a caption..."></textarea>
      </div>

      <div>
        <label><strong>Tags (comma separated)</strong></label>
        <input id="tags" placeholder="music,fun,design">
      </div>

      <div>
        <label><strong>Location (optional)</strong></label>
        <input id="location" placeholder="City, School, Venue">
      </div>

      <div style="margin-top:10px">
        <button id="postBtn">Post</button>
        <button id="cancelBtn" style="margin-left:8px;background:#ddd;color:#000">Cancel</button>
      </div>
    </div>
  </div>

<script>
function getProfile(){ return JSON.parse(localStorage.getItem('profile')||'null'); }
function getPosts(){ return JSON.parse(localStorage.getItem('posts')||'[]'); }
function savePosts(list){ localStorage.setItem('posts', JSON.stringify(list)); }

const imageInput = document.getElementById('imageInput');
const preview = document.getElementById('preview');

let selectedDataUrl = null;
imageInput.addEventListener('change', (e) => {
  const f = e.target.files[0];
  if (!f) return;
  const reader = new FileReader();
  reader.onload = () => {
    selectedDataUrl = reader.result;
    preview.innerHTML = `<img src="${selectedDataUrl}" alt="preview">`;
  };
  reader.readAsDataURL(f);
});

document.getElementById('postBtn').addEventListener('click', () => {
  const profile = getProfile();
  if (!profile){
    if (!confirm('You must create a profile to post. Create profile now?')) return;
    window.location.href = 'profile.html';
    return;
  }

  if (!selectedDataUrl){
    alert('Choose an image first.');
    return;
  }

  const caption = document.getElementById('caption').value.trim();
  const tags = document.getElementById('tags').value.trim();
  const location = document.getElementById('location').value.trim();

  const posts = getPosts();
  const newPost = {
    id: Date.now().toString(),
    username: profile.username,
    profilePic: profile.profilePic || '',
    verified: profile.verified || false,
    caption: caption,
    tags: tags,
    location: location,
    image: selectedDataUrl,
    likes: 0,
    likedBy: [],
    comments: [],
    hideComments: false,
    hideLikes: false,
    time: new Date().toLocaleString()
  };
  posts.unshift(newPost);
  savePosts(posts);
  alert('Post created!');
  window.location.href = 'feed.html';
});

document.getElementById('cancelBtn').addEventListener('click', () => {
  window.location.href = 'feed.html';
});
</script>
</body>
</html>
